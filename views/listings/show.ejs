<% layout('layouts/bp') %>
<body>
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-md-8">

        <div class="card shadow-lg border-0 mb-3 mt-3">
        <h2 class="card-title text-center fw-bold text-primary mb-4 mt-3"><%= listing.title %></h2>
          <img src="<%= listing.image.url %>" class="card-img-top img-fluid rounded-top" style="height: 350px; object-fit: contain;" alt="Listing Image">

          <div class="card-body">
            
            <ul class="list-group list-group-flush mb-3">
              <li class="list-group-item">
                <strong class="text-dark">Description:</strong>
                <p class="mb-0"><%= listing.description %></p>
              </li>
              <li class="list-group-item">
                <strong class="text-dark">Price:</strong>
                <span class="text-success fw-semibold">₹<%= listing.price.toLocaleString("en-IN") %></span>
              </li>
              <li class="list-group-item">
                <strong class="text-dark">Location:</strong>
                <%= listing.location %>, <%= listing.country %>
              </li>
            </ul>

            <div class="d-flex justify-content-between mt-4">
              <a href="/listing" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left"></i> Back to Listings
              </a>
              <a href="/listing/<%= listing._id %>/edit" class="btn btn-warning text-white">
                <i class="bi bi-pencil-fill"></i> Edit
              </a>
              <form method="POST" action="/listing/<%= listing._id %>?_method=DELETE" onsubmit="return confirm('Are you sure you want to delete this listing?')">
                <button type="submit" class="btn btn-danger">
                  <i class="bi bi-trash-fill"></i> Delete
                </button>
              </form>
            </div>
          </div>
          <hr>
          <div class="Review my-5">
            <div class="card border-0 shadow-sm p-4 bg-light">
              <h4 class="card-title mb-4 text-primary fw-bold">
                <i class="bi bi-chat-left-text-fill me-2"></i> Write a Review
              </h4>
              <form action="/listing/<%= listing._id %>/review"class="needs-validation" novalidate method="POST" >
                <div class="mb-4">
                  <label for="rating" class="form-label fw-semibold">Rating</label>
                  <input 
                    type="range" 
                    id="rating" 
                    name="review[rating]" 
                    min="1" 
                    max="5" 
                    class="form-range"
                    required
                  >
                  <div class="form-text">Slide to select a rating from 1 to 5</div>
                </div>
          
                <div class="mb-4">
                  <label for="comment" class="form-label fw-semibold">Comment</label>
                  <textarea 
                    name="review[comment]" 
                    id="comment" 
                    class="form-control" 
                    rows="4" 
                    required>
                  </textarea>
                  <div class="invalid-feedback">please enter a comment</div>
                </div>
          
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary">
                    <i class="bi bi-send-fill me-1"></i> Submit Review
                  </button>
                </div>
              </form>
              <hr>
              <div class="mt-5">
                <h4 class="text-primary fw-bold mb-4">
                  <i class="bi bi-stars me-2"></i> All Reviews
                </h4>
                <% if (listing.reviews.length > 0) { %>
                  <ul class="list-group">
                    <% for (let review of listing.reviews) { %>
                      <li class="list-group-item bg-white shadow-sm rounded mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <span class="badge bg-warning text-dark fs-6 px-3 py-2 rounded-pill">
                            <%= review.rating %> ★
                          </span>
                          <small class="text-muted">
                            <%= new Date(review.createdAt).toLocaleDateString() %>
                          </small>
                        </div>
                        <p class="mb-0"><%= review.comment %></p>
                        <form method="post" action="/listing/<%= listing._id %>/review/<%= review._id%>?_method=delete">
                          <button class="btn btn-sm btn-danger mb-3 mt-3"> <i class="bi bi-trash-fill"></i> Delete</button>
                        </form>
                      </li>
                    <% } %>
                  </ul>
                <% } else { %>
                  <p class="text-muted fst-italic">No reviews yet. Be the first to write one!</p>
                <% } %>
              </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="/js/script.js"></script>
</body>
